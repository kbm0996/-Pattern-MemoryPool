# λ©”λ¨λ¦¬ ν’€
## π“Ά κ°μ”
β€‚**λ©”λ¨λ¦¬ λ‹¨νΈν™”**(Memory Fragmentation)λ€ ν™μ— μ‚¬μ© κ°€λ¥ν• λ©”λ¨λ¦¬ κ³µκ°„μ΄ λ­‰μ³ μμ§€ μ•κ³  μ‘κ² μ΅°κ°λ‚ μλ” μƒνƒλ¥Ό μλ―Έν•λ‹¤. μ „μ²΄ μ‚¬μ© κ°€λ¥ν• λ©”λ¨λ¦¬ μ–‘μ€ λ§μ•„λ„ μ—°μ†ν•΄μ„ μ‚¬μ© κ°€λ¥ν• μμ—­μ΄ μ‘μ•„μ Έ μ„±λ¥μ΄ μ €ν•λλ‹¤. new μ—°μ‚°μλ‚ mallocλ΅ λ©”λ¨λ¦¬λ¥Ό λ§¤λ² λ™μ μΌλ΅ ν• λ‹Ή, ν•΄μ ν•λ©΄ λ©”λ¨λ¦¬ λ‹¨νΈν™”κ°€ λ°μƒν•  μ μλ‹¤. λ™μ  ν• λ‹Ήμ΄ μ¦μ€ μ‹¤μ‹κ°„ ν”„λ΅κ·Έλ¨μ—μ„λ” λ” μμ£Ό λ°μƒν•λ‹¤.
  
β€‚**λ©”λ¨λ¦¬ ν’€**(Memory Pool)μ€ λ©”λ¨λ¦¬λ¥Ό κ³ μ • ν¬κΈ°λ΅ λ―Έλ¦¬ ν• λ‹Ήν•΄λ‘” κ²ƒμ΄λ‹¤. ν’€μ— λ“¤μ–΄μλ” λ©”λ¨λ¦¬λ¥Ό μ¬μ‚¬μ©ν•¨μΌλ΅μ¨ λ©”λ¨λ¦¬ μ‚¬μ© μ„±λ¥μ„ μµμ ν™” ν•  μ μλ‹¤. λ©”λ¨λ¦¬λ¥Ό μ¬μ‚¬μ©ν•  λ• μ‚¬μ© κ°€λ¥ν• λ©”λ¨λ¦¬ λΈ”λ΅μ„ μ§€μ†μ μΌλ΅ μ¶”μ ν•λ©΄ μ‚¬μ© κ°€λ¥ν• λ©”λ¨λ¦¬ λΈ”λ΅μ„ μ°ΎλλΌκ³  μ‹κ°„μ„ λ‚­λΉ„ν•μ§€ μ•μ•„λ„ λλ‹¤. μ¶”μ ν•λ” λ°©λ²• μ¤‘ μ‚¬μ© κ°€λ¥ν• λ©”λ¨λ¦¬ λΈ”λ΅μ ν¬μΈν„°λ¥Ό λ³„λ„μ λ¦¬μ¤νΈμ— μ €μ¥ν•λ” κ²ƒμ„ **λΉμΉΈ λ©λ΅**(Free List)μ΄λΌκ³  ν•λ‹¤.
  
  ![capture](https://www.oreilly.com/library/view/unity-2017-game/9781788392365/assets/cd05d279-9a5f-4620-9d02-e44183044217.png)
  
  **figure 1. Memory Fragmentation Example*
   
## π“‘ κµ¬μ„±
### π’» CMemoryPool
μΌλ°μ μΈ λ©”λ¨λ¦¬ν’€
### π’» CLFMemoryPool
`μ“°λ λ“ μ•μ „(Thread- safety)`ν•κ² `interlocked ν•¨μ(atomic μ—°μ‚°)`λ¥Ό κΈ°λ°μΌλ΅ ν• `λ½ν”„λ¦¬(Lock-free)` μ•κ³ λ¦¬μ¦μ„ μ μ©μ‹ν‚¨ λ©”λ¨λ¦¬ν’€

* **λ½ν”„λ¦¬(Lock-free) μ•κ³ λ¦¬μ¦** : `CAS(Compare And Swap)`ν•λ©΄μ„ μ‚½μ…, μ‚­μ κ°€ μ„±κ³µμ μΌλ΅ μ΄λ£¨μ–΄μ§ λ•κΉμ§€ λ¬΄ν• λ°λ³µν•λ” κ²ƒ. SRWLockμ΄λ‚ CriticalSectionμ μµμ… μ¤‘ ν•λ‚μΈ μ¤ν•€λ½(Spinlock)κ³Ό μ μ‚¬

### π’» CLFMemoryPool_TLS
λ½ν”„λ¦¬ λ©”λ¨λ¦¬ν’€μ—μ„ μ„±λ¥μ„ ν–¥μƒμ‹ν‚¤κΈ° μ„ν•΄ `TLS(Thread Local Storage)`λ¥Ό μ μ©μ‹ν‚¨ λ©”λ¨λ¦¬ν’€
